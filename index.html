<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sphinx Focus - Pomodoro Timer & Productivity Tracker</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <!-- <div class="logo-icon">
                    <img src="media/spinx-full-no-background.png" alt="Sphinx" class="sphinx-logo">
                </div> -->
                <div class="logo-text">Sphinx Focus</div>
            </div>
            <div class="header-controls">
                <button class="version-badge" onclick="openChangelog()" title="View changelog">
                    <span class="version-text">v<span id="appVersion"></span></span>
                </button>
                <button class="btn btn-secondary btn-icon" id="focusModeBtn" onclick="toggleFocusMode()" title="Focus Mode (Ctrl+F)">
                    <span class="material-symbols-outlined">visibility</span>
                </button>
                <button class="btn btn-secondary btn-icon" onclick="openStorageInfo()" title="Storage information">
                    <span class="material-symbols-outlined">info</span>
                </button>
                <button class="btn btn-secondary btn-icon" onclick="openSettings()" title="Settings">
                    <span class="material-symbols-outlined">settings</span>
                </button>
                <div class="theme-selector">
                    <button class="theme-toggle" onclick="toggleThemeDropdown()">
                        <span class="material-symbols-outlined" id="themeIcon">dark_mode</span>
                    </button>
                    <div class="theme-dropdown" id="themeDropdown">
                        <button class="theme-option" onclick="setTheme('light')">
                            <span class="material-symbols-outlined">light_mode</span>
                            <span>Light</span>
                        </button>
                        <button class="theme-option" onclick="setTheme('dark')">
                            <span class="material-symbols-outlined">dark_mode</span>
                            <span>Dark</span>
                        </button>
                        <button class="theme-option" onclick="setTheme('system')">
                            <span class="material-symbols-outlined">contrast</span>
                            <span>System</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="main-grid">
            <!-- Timer Section -->
            <div class="card">
                <div class="card-header-with-toggle">
                    <h2 class="card-title" id="timerModeTitle">Pomodoro Timer</h2>
                    <div class="mode-controls">
                        <div class="mode-toggle-buttons">
                            <button class="mode-toggle-btn active" id="pomodoroModeBtn" onclick="switchToPomodoro()" title="Pomodoro Mode">
                                <span class="material-symbols-outlined">schedule</span>
                            </button>
                            <button class="mode-toggle-btn" id="fibonacciModeBtn" onclick="toggleFibonacciMode()" title="Fibonacci Mode">
                                <span class="material-symbols-outlined">functions</span>
                            </button>
                        </div>
                        <button class="mode-settings-btn" id="fibonacciSettingsBtn" onclick="openFibonacciModal()" title="Fibonacci Settings" style="display: none;">
                            <span class="material-symbols-outlined">settings</span>
                        </button>
                    </div>
                </div>
                <div class="timer-display">
                    <div class="timer-mode work" id="timerMode">Focus Time</div>
                    <div class="timer-time" id="timerDisplay">25:00</div>
                    
                    <svg class="progress-ring" viewBox="0 0 200 200">
                        <circle
                            class="progress-ring-circle"
                            stroke="var(--bg-tertiary)"
                            stroke-width="8"
                            fill="transparent"
                            r="88"
                            cx="100"
                            cy="100"
                        />
                        <circle
                            id="progressCircle"
                            class="progress-ring-circle"
                            stroke="url(#gradient)"
                            stroke-width="8"
                            fill="transparent"
                            r="88"
                            cx="100"
                            cy="100"
                            stroke-dasharray="553"
                            stroke-dashoffset="553"
                        />
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:var(--primary-color);stop-opacity:1" />
                                <stop offset="100%" style="stop-color:var(--secondary-color);stop-opacity:1" />
                            </linearGradient>
                        </defs>
                    </svg>
                </div>

                <div class="timer-controls">
                    <button class="btn btn-primary" id="startBtn" onclick="toggleTimer()">
                        <span class="material-symbols-outlined">play_arrow</span>
                        <span>Start</span>
                    </button>
                    <button class="btn btn-secondary" onclick="resetTimer()">
                        <span class="material-symbols-outlined">refresh</span>
                        <span>Reset</span>
                    </button>
                    <button class="btn btn-secondary" onclick="skipSession()">
                        <span class="material-symbols-outlined">skip_next</span>
                        <span>Skip</span>
                    </button>
                </div>

                <div class="session-settings">
                    <div class="setting-group">
                        <label class="setting-label">Focus (min)</label>
                        <input type="number" class="setting-input" id="workDuration" value="25" min="1" max="60">
                    </div>
                    <div class="setting-group">
                        <label class="setting-label">Break (min)</label>
                        <input type="number" class="setting-input" id="breakDuration" value="5" min="1" max="30">
                    </div>
                    <div class="setting-group">
                        <label class="setting-label">Long Break (min)</label>
                        <input type="number" class="setting-input" id="longBreakDuration" value="15" min="1" max="60">
                    </div>
                </div>
            </div>

            <!-- Tasks Section -->
            <div class="card">
                <h2 class="card-title">Tasks & Goals</h2>
                <div class="task-input-group">
                    <input type="text" class="task-input" id="taskInput" placeholder="What are you working on?">
                    <button class="btn btn-primary" onclick="addTask()">Add</button>
                </div>
                <div class="task-list" id="taskList"></div>
            </div>
        </div>

        <!-- Quality Trends Section -->
        <div class="card" id="qualityTrendsCard">
            <h2 class="card-title">Quality Trends</h2>
            <div class="quality-stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="avgFocusQuality">-</div>
                    <div class="stat-label">Avg Focus Quality</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgRestQuality">-</div>
                    <div class="stat-label">Avg Rest Quality</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalRatings">0</div>
                    <div class="stat-label">Total Ratings</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="skippedPomodoros">0</div>
                    <div class="stat-label">Skipped Pomodoros</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="skippedRests">0</div>
                    <div class="stat-label">Skipped Rests</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="qualityChart"></canvas>
            </div>
            <div class="quality-empty-state" id="qualityEmptyState">
                <span class="material-symbols-outlined" style="font-size: 48px; color: var(--text-tertiary);">insights</span>
                <p style="margin-top: 12px; color: var(--text-secondary);">No quality ratings yet. Complete a session to start tracking!</p>
            </div>
        </div>

        <!-- Statistics Section -->
        <div class="card">
            <h2 class="card-title">Weekly Progress</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="todayPomodoros">0</div>
                    <div class="stat-label">Pomodoros</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="todayFocusTime">0h 0m</div>
                    <div class="stat-label">Focus Time</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="todayTasks">0</div>
                    <div class="stat-label">Tasks Completed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="currentStreak">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="focusChart"></canvas>
            </div>
        </div>

    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal" onclick="closeModalOnBackgroundClick(event, 'settingsModal', closeSettings)">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Settings</h2>
                <button class="modal-close" onclick="closeSettings()">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <!-- Storage Usage Indicator -->
            <div class="storage-usage-section">
                <div class="storage-usage-header">
                    <span class="storage-usage-label">Storage Usage</span>
                    <span class="storage-usage-value" id="storageUsageText">0%</span>
                </div>
                <div class="storage-progress-bar">
                    <div class="storage-progress-fill" id="storageProgressFill"></div>
                </div>
                <div class="storage-usage-details">
                    <span id="storageUsageDetails">0 KB of 4 MB used</span>
                </div>
            </div>
            
            <div class="settings-section">
                <h3 class="settings-section-title">Notifications</h3>
                <div class="toggle-group">
                    <span class="toggle-label">Sound Notifications</span>
                    <div class="toggle-switch" id="soundToggle" onclick="toggleSetting('sound')">
                        <div class="toggle-switch-handle"></div>
                    </div>
                </div>
                <div class="toggle-group">
                    <span class="toggle-label">Browser Notifications</span>
                    <div class="toggle-switch" id="notificationToggle" onclick="toggleSetting('notification')">
                        <div class="toggle-switch-handle"></div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h3 class="settings-section-title">Timer Settings</h3>
                <div class="toggle-group">
                    <span class="toggle-label">Auto-start Breaks</span>
                    <div class="toggle-switch" id="autoBreakToggle" onclick="toggleSetting('autoBreak')">
                        <div class="toggle-switch-handle"></div>
                    </div>
                </div>
                <div class="toggle-group">
                    <span class="toggle-label">Auto-start Pomodoros</span>
                    <div class="toggle-switch" id="autoPomodoroToggle" onclick="toggleSetting('autoPomodoro')">
                        <div class="toggle-switch-handle"></div>
                    </div>
                </div>
                <div class="toggle-group">
                    <span class="toggle-label">Resume Timer After Refresh</span>
                    <div class="toggle-switch active" id="resumeTimerToggle" onclick="toggleSetting('resumeTimer')">
                        <div class="toggle-switch-handle"></div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h3 class="settings-section-title">Quality Tracking</h3>
                <div class="toggle-group">
                    <span class="toggle-label">Quality Dialog</span>
                    <div class="toggle-switch active" id="qualityDialogToggle" onclick="toggleSetting('qualityDialog')">
                        <div class="toggle-switch-handle"></div>
                    </div>
                </div>
                <p class="settings-disclaimer">
                    <span class="material-symbols-outlined" style="font-size: 16px; vertical-align: middle;">info</span>
                    This feature prompts you after each session. While it may feel intrusive, tracking quality helps you understand your focus patterns over time.
                </p>
            </div>

            <div class="settings-section">
                <h3 class="settings-section-title">Sessions</h3>
                <div class="setting-group">
                    <label class="setting-label">Sessions until long break</label>
                    <input type="number" class="setting-input" id="sessionsUntilLongBreak" value="4" min="2" max="10">
                </div>
            </div>

            <div class="settings-section">
                <button class="btn btn-danger" onclick="clearAllData()">
                    <span class="material-symbols-outlined">delete</span>
                    <span>Clear All Data</span>
                </button>

                <div class="settings-section">
                    <h3 class="settings-section-title">Data Management</h3>
                    <div class="export-import-controls">
                        <button class="btn btn-secondary" onclick="exportData()">
                            <span class="material-symbols-outlined">download</span>
                            <span>Export Data</span>
                        </button>
                        <button class="btn btn-secondary" onclick="importData()">
                            <span class="material-symbols-outlined">upload</span>
                            <span>Import Data</span>
                        </button>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(event)">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Focus Mode Indicator -->
    <div class="blur-control-indicator" id="focusModeIndicator">
        <span class="material-symbols-outlined">visibility</span>
        <span class="blur-control-indicator-text">Focus Mode Active (ESC to exit)</span>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-icon">
            <span class="material-symbols-outlined">notifications</span>
        </div>
        <div class="notification-content">
            <div class="notification-title" id="notificationTitle">Session Complete!</div>
            <div class="notification-message" id="notificationMessage">Time for a break</div>
        </div>
    </div>

    <!-- Disclaimer Modal -->
    <div class="disclaimer-modal" id="disclaimerModal">
        <div class="disclaimer-content">
            <div class="modal-logo">
                <img src="media/Kitty-and-Sphinx.png" alt="Sphinx" class="modal-logo-img">
            </div>
            <h2 class="disclaimer-title">Welcome to Sphinx Focus!</h2>
            <div class="disclaimer-text">
                <p>Before you begin using this productivity tool, please read the following disclaimer:</p>
                
                <p>This application is provided for <strong>informational and productivity purposes only</strong>. While the Pomodoro Technique is a widely-used time management method, results may vary for different individuals.</p>
                
                <p>The app stores all your data <strong>locally in your browser</strong> using encrypted localStorage. Your data never leaves your device. However, clearing your browser data will result in loss of your stored information unless you have exported a backup.</p>
                
                <p>The developers of this app are <strong>not responsible or liable</strong> for any loss of data, productivity outcomes, or any other direct, indirect, incidental, special, or consequential damages arising from the use of this application.</p>
                
                <p>You must be <strong>at least 13 years old</strong> to use this app.</p>
                
                <p>By clicking <strong>"I Agree"</strong>, you acknowledge that you have read this disclaimer and agree to its terms.</p>
            </div>
            <div class="disclaimer-actions">
                <button class="btn btn-secondary" onclick="declineDisclaimer()">Decline</button>
                <button class="btn btn-primary" onclick="acceptDisclaimer()">I Agree</button>
            </div>
        </div>
    </div>

    <!-- Storage Info Modal with Tabs -->
    <div class="settings-modal" id="storageInfoModal" onclick="closeModalOnBackgroundClick(event, 'storageInfoModal', closeStorageInfo)">
        <div class="modal-content info-modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <span class="material-symbols-outlined" style="vertical-align: middle; margin-right: 8px;">info</span>
                    Information & Guides
                </h2>
                <button class="modal-close" onclick="closeStorageInfo()">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <!-- Tab Navigation -->
            <div class="info-tabs">
                <button class="info-tab active" onclick="switchInfoTab('storage')" data-tab="storage">
                    <span class="material-symbols-outlined">storage</span>
                    <span>Storage</span>
                </button>
                <button class="info-tab" onclick="switchInfoTab('fibonacci')" data-tab="fibonacci">
                    <span class="material-symbols-outlined">functions</span>
                    <span>Fibonacci Mode</span>
                </button>
            </div>
            
            <!-- Storage Tab Content -->
            <div class="info-tab-content active" id="storageTabContent">
                <div class="storage-info-content">
                <div class="storage-info-section">
                    <h3>How Storage Works</h3>
                    <p>Sphinx Focus stores all your data <strong>locally in your browser</strong> using encrypted localStorage. Your data never leaves your device.</p>
                </div>
                
                <div class="storage-info-section">
                    <h3>Storage Limits</h3>
                    <div class="storage-limits-grid">
                        <div class="limit-item">
                            <div class="limit-label">Maximum Storage</div>
                            <div class="limit-value">4 MB</div>
                        </div>
                        <div class="limit-item">
                            <div class="limit-label">Sessions Limit</div>
                            <div class="limit-value">1,000</div>
                        </div>
                        <div class="limit-item">
                            <div class="limit-label">Quality Ratings</div>
                            <div class="limit-value">1,000</div>
                        </div>
                        <div class="limit-item">
                            <div class="limit-label">Data Retention</div>
                            <div class="limit-value">90 days</div>
                        </div>
                    </div>
                </div>
                
                <div class="storage-info-section">
                    <h3>Automatic Protection</h3>
                    <p>Sphinx Focus automatically manages storage for you:</p>
                    <ul class="storage-features-list">
                        <li><strong>90-Day Retention:</strong> Data older than 90 days is automatically removed</li>
                        <li><strong>Progressive Cleanup:</strong> When storage reaches 75%, older data is gradually removed</li>
                        <li><strong>Smart Limits:</strong> Only the most recent 1,000 sessions and ratings are kept</li>
                        <li><strong>User Alerts:</strong> You'll be notified when storage is getting full</li>
                    </ul>
                </div>
                
                <div class="storage-info-section">
                    <h3>What Happens When Storage Gets Full?</h3>
                    <div class="storage-cleanup-stages">
                        <div class="cleanup-stage">
                            <div class="stage-badge stage-light">75-79%</div>
                            <div class="stage-description">
                                <strong>Light Cleanup:</strong> Keep last 500 sessions/ratings, remove completed tasks older than 7 days
                            </div>
                        </div>
                        <div class="cleanup-stage">
                            <div class="stage-badge stage-medium">80-89%</div>
                            <div class="stage-description">
                                <strong>Medium Cleanup:</strong> Keep last 250 sessions/ratings, remove all completed tasks
                            </div>
                        </div>
                        <div class="cleanup-stage">
                            <div class="stage-badge stage-aggressive">90%+</div>
                            <div class="stage-description">
                                <strong>Aggressive Cleanup:</strong> Keep last 100 sessions/ratings, keep only active tasks
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="storage-info-section">
                    <h3>Best Practices</h3>
                    <ul class="storage-features-list">
                        <li><strong>Export Regularly:</strong> Use "Export Data" monthly to backup your progress</li>
                        <li><strong>Clear Old Data:</strong> After exporting, use "Clear All Data" to start fresh</li>
                        <li><strong>Manage Tasks:</strong> Complete and delete tasks you no longer need</li>
                        <li><strong>Watch Warnings:</strong> Pay attention to storage notifications</li>
                    </ul>
                </div>
                
                <div class="storage-info-section storage-info-note">
                    <span class="material-symbols-outlined" style="font-size: 20px; vertical-align: middle;">info</span>
                    <span><strong>Note:</strong> Your active tasks, settings, and preferences are never automatically deleted.</span>
                </div>
                </div>
            </div>
            
            <!-- Fibonacci Tab Content -->
            <div class="info-tab-content" id="fibonacciTabContent">
                <div class="fibonacci-info-content">
                    <div class="fibonacci-section">
                        <h3>How It Works</h3>
                        <p>Fibonacci Guided Mode is an adaptive focus timer that automatically adjusts your session length based on your quality ratings. It uses the Fibonacci sequence to progressively increase or decrease your focus time.</p>
                    </div>
                    
                    <div class="fibonacci-section">
                        <h3>The Fibonacci Sequence</h3>
                        <div class="fibonacci-sequence-display">
                            <span>1</span>
                            <span>2</span>
                            <span>3</span>
                            <span>5</span>
                            <span>8</span>
                            <span>13</span>
                            <span>21</span>
                            <span>34</span>
                            <span>55</span>
                            <span>89</span>
                        </div>
                        <p class="fibonacci-note">Focus sessions range from 1 to 89 minutes</p>
                    </div>
                    
                    <div class="fibonacci-section">
                        <h3>Automatic Adjustment Rules</h3>
                        <div class="adjustment-rules">
                            <div class="rule-item rule-decrease">
                                <span class="rule-icon material-symbols-outlined">trending_down</span>
                                <div class="rule-content">
                                    <strong>Rating &lt; 7</strong>
                                    <p>Decrease to previous Fibonacci interval</p>
                                </div>
                            </div>
                            <div class="rule-item rule-maintain">
                                <span class="rule-icon material-symbols-outlined">trending_flat</span>
                                <div class="rule-content">
                                    <strong>Rating 8-9</strong>
                                    <p>Stay at current interval</p>
                                </div>
                            </div>
                            <div class="rule-item rule-increase">
                                <span class="rule-icon material-symbols-outlined">trending_up</span>
                                <div class="rule-content">
                                    <strong>Rating 10</strong>
                                    <p>Increase to next Fibonacci interval</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fibonacci-section">
                        <h3>Break Duration</h3>
                        <p>Breaks are automatically calculated using a 1:5 ratio from your focus time. For example:</p>
                        <ul class="break-examples">
                            <li>1 min focus = 12 seconds break</li>
                            <li>2 min focus = 24 seconds break</li>
                            <li>3 min focus = 36 seconds break</li>
                            <li>5 min focus = 1 minute break</li>
                            <li>8 min focus = 1 min 36 sec break</li>
                            <li>13 min focus = 2 min 36 sec break</li>
                            <li>21 min focus = 4 min 12 sec break</li>
                            <li>34 min focus = 6 min 48 sec break</li>
                            <li>55 min focus = 11 minutes break</li>
                            <li>89 min focus = 17 min 48 sec break</li>
                        </ul>
                    </div>
                    
                    <div class="fibonacci-section">
                        <h3>Requirements</h3>
                        <div class="fibonacci-requirement">
                            <span class="material-symbols-outlined">info</span>
                            <p><strong>Quality Dialog must be enabled</strong> for Fibonacci Guided Mode to work. It will be automatically enabled when you activate this mode.</p>
                        </div>
                    </div>
                    
                    <div class="fibonacci-section">
                        <h3>Getting Started</h3>
                        <ol class="fibonacci-steps">
                            <li>Click the <strong>Functions icon (∆í)</strong> in the timer card header</li>
                            <li>The mode will activate and Quality Dialog will be enabled</li>
                            <li>Start your first 1-minute focus session</li>
                            <li>After completion, rate your focus quality (1-10)</li>
                            <li>The system automatically adjusts your next session length</li>
                            <li>Continue the cycle - the timer adapts to your optimal focus duration</li>
                        </ol>
                    </div>
                    
                    <div class="fibonacci-section">
                        <h3>Customization</h3>
                        <p>Click the <strong>Settings icon (‚öôÔ∏è)</strong> next to the mode toggle to customize:</p>
                        <ul class="break-examples">
                            <li>Rating thresholds for adjustments</li>
                            <li>Minimum and maximum duration limits</li>
                            <li>Excluded numbers from the sequence</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Changelog Modal -->
    <div class="settings-modal" id="changelogModal" onclick="closeModalOnBackgroundClick(event, 'changelogModal', closeChangelog)">
        <div class="modal-content">
            <div class="modal-logo">
                <img src="media/KItty.png" alt="Sphinx" class="modal-logo-img">
            </div>
            <div class="modal-header">
                <h2 class="modal-title">
                    <span class="material-symbols-outlined" style="vertical-align: middle; margin-right: 8px;">history</span>
                    What's New
                </h2>
                <button class="modal-close" onclick="closeChangelog()">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <div class="changelog-content">
                <!-- Version 2.2.0 -->
                <div class="changelog-version">
                    <div class="version-header">
                        <h3>Version 2.2.0 <span class="version-badge-tag current">Current</span></h3>
                        <span class="version-date">November 2025</span>
                    </div>
                    <div class="changelog-section">
                        <h4>üé® User Experience</h4>
                        <ul>
                            <li><strong>Fibonacci Modal Improvements</strong> - Info/close buttons use primary color, removed dividers, "Save Customization" aligned with action buttons</li>
                            <li><strong>Button Hover Effects</strong> - Added glow, subtle zoom, and color shifts to all buttons for better interactivity</li>
                            <li><strong>Timer Controls Enhancement</strong> - Main button alternates between "Start", "Resume", and "Pause"; Reset returns to "Start"</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <h4>üêõ Bug Fixes</h4>
                        <ul>
                            <li><strong>Timer Reset Behavior</strong> - Reset now fully clears session state, showing "Start" instead of "Resume"</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Version 2.1.2 -->
                <div class="changelog-version">
                    <div class="version-header">
                        <h3>Version 2.1.2</h3>
                        <span class="version-date">October 2025</span>
                    </div>
                    <div class="changelog-section">
                        <h4>üé® User Experience</h4>
                        <ul>
                            <li><strong>Version Modal</strong> - Removed double scrollbar; only the styled inner content scrolls</li>
                            <li><strong>Scrollbar Spacing</strong> - Added right padding and stable scrollbar gutters for better readability</li>
                            <li><strong>Storage Info Modal</strong> - Removed double scrollbar; consistent styled scrolling</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <h4>üêõ Bug Fixes</h4>
                        <ul>
                            <li><strong>Task Ordering</strong> - New and re-activated tasks now always appear at the very top</li>
                        </ul>
                    </div>
                </div>

                <!-- Version 2.1.1 -->
                <div class="changelog-version">
                    <div class="version-header">
                        <h3>Version 2.1.1</h3>
                        <span class="version-date">October 2025</span>
                    </div>
                    <div class="changelog-section">
                        <h4>‚ú® New Features</h4>
                        <ul>
                            <li><strong>Skip Tracking</strong> - Track and display skipped Pomodoros and skipped Rests</li>
                            <li>Two new stat cards in Quality Trends section showing skip counts</li>
                            <li>Persistent storage of skip statistics across sessions</li>
                            <li><strong>Smart Storage Management</strong> - Automatic data cleanup when storage limits are approached</li>
                            <li>Progressive cleanup strategies (light, medium, aggressive) based on storage usage</li>
                            <li>Automatic removal of data older than 90 days</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <h4>üõ°Ô∏è Storage Protection</h4>
                        <ul>
                            <li><strong>QuotaExceededError Handling</strong> - Gracefully handles storage full scenarios</li>
                            <li>User notifications when storage is full or nearing capacity</li>
                            <li>Automatic retry with data cleanup if save fails due to quota</li>
                            <li>Storage limits reduced for safety: 1,000 sessions, 1,000 quality ratings (down from 10,000 each)</li>
                            <li>Warnings at 75% storage usage, cleanup at 80%+</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <h4>üé® User Experience</h4>
                        <ul>
                            <li><strong>Modal Improvements</strong> - Modals can now be closed by clicking on the background</li>
                            <li>Enhanced modal interaction for better usability</li>
                            <li><strong>Mobile Responsiveness</strong> - Significantly improved mobile experience for all screen sizes</li>
                            <li>Optimized layout, typography, and spacing for phones (including iPhone SE, Pixel 7, etc.)</li>
                            <li>Better button sizing and touch targets on mobile devices</li>
                            <li>Improved readability and usability on small screens</li>
                            <li><strong>Storage Info Modal</strong> - New info icon with comprehensive storage management explanation</li>
                            <li><strong>Storage Usage Indicator</strong> - Real-time progress bar in settings showing storage usage</li>
                            <li>Color-coded storage warnings (green &lt; 75%, yellow 75-89%, red 90%+)</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <h4>üêõ Bug Fixes</h4>
                        <ul>
                            <li><strong>Quality Chart Display</strong> - Fixed chart rendering to show smooth curves connecting data points instead of isolated dots</li>
                            <li>Enhanced visual continuity in Quality Trends chart for better data visualization</li>
                        </ul>
                    </div>
                </div>

                <!-- Version 2.1.0 -->
                <div class="changelog-version">
                    <div class="version-header">
                        <h3>Version 2.1.0</h3>
                        <span class="version-date">October 2025</span>
                    </div>
                    <div class="changelog-section">
                        <h4>‚ú® New Features</h4>
                        <ul>
                            <li><strong>Quality Dialog</strong> - Rate your focus and rest quality after each session</li>
                            <li><strong>Quality Trends Chart</strong> - Visualize your focus and rest quality over time with dual-line chart</li>
                            <li><strong>Quality Statistics</strong> - Track average focus quality, rest quality, and total ratings</li>
                            <li><strong>Settings Control</strong> - Toggle quality tracking on/off with helpful disclaimer</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <h4>üìä Quality Tracking</h4>
                        <ul>
                            <li>Rate focus quality (1-10) after work sessions</li>
                            <li>Rate rest quality (1-10) after breaks</li>
                            <li>Beautiful slider interface with real-time feedback</li>
                            <li>Skip option - no pressure to rate every session</li>
                            <li>Encrypted storage for all quality data</li>
                            <li>Export/import support included</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <h4>üé® User Experience</h4>
                        <ul>
                            <li>Non-intrusive dialog timing (500ms delay)</li>
                            <li>Works seamlessly with auto-start features</li>
                            <li>Empty state with helpful guidance</li>
                            <li>Professional UI matching app design</li>
                        </ul>
                    </div>
                </div>

                <!-- Version 2.0.0 -->
                <div class="changelog-version">
                    <div class="version-header">
                        <h3>Version 2.0.0</h3>
                        <span class="version-date">October 2025</span>
                    </div>
                    <div class="changelog-section">
                        <h4>üîê Security Enhancements</h4>
                        <ul>
                            <li><strong>AES-GCM 256-bit Encryption</strong> - All data now encrypted at rest</li>
                            <li><strong>XSS Protection</strong> - Complete input sanitization</li>
                            <li><strong>Data Validation</strong> - Comprehensive validation on all stored data</li>
                            <li><strong>Import Security</strong> - Multi-layer validation for imported files</li>
                            <li><strong>Storage Limits</strong> - Protection against quota exhaustion</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <h4>üèóÔ∏è Architecture Improvements</h4>
                        <ul>
                            <li><strong>Service Layer</strong> - Clean separation of concerns</li>
                            <li><strong>Encryption Service</strong> - Dedicated encryption management</li>
                            <li><strong>Storage Service</strong> - Centralized storage operations</li>
                            <li><strong>Error Handling</strong> - Comprehensive error recovery</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <h4>‚ú® New Features</h4>
                        <ul>
                            <li><strong>Timer Persistence</strong> - Timer continues after page refresh</li>
                            <li><strong>Resume Notification</strong> - Visual feedback when timer resumes</li>
                            <li><strong>Disclaimer Modal</strong> - Professional first-time user experience</li>
                            <li><strong>Auto Migration</strong> - Seamless upgrade from v1.0</li>
                            <li><strong>Resume Control</strong> - Optional setting to disable timer resume</li>
                        </ul>
                    </div>
                    <div class="changelog-section">
                        <h4>üìö Documentation</h4>
                        <ul>
                            <li>Complete security documentation (SECURITY.md)</li>
                            <li>Comprehensive testing guide (TESTING.md)</li>
                            <li>Quick start guide (QUICKSTART.md)</li>
                            <li>Detailed improvements log (IMPROVEMENTS.md)</li>
                        </ul>
                    </div>
                </div>

                <!-- Version 1.0.0 -->
                <div class="changelog-version">
                    <div class="version-header">
                        <h3>Version 1.0.0</h3>
                        <span class="version-date">Initial Release</span>
                    </div>
                    <div class="changelog-section">
                        <h4>üéØ Core Features</h4>
                        <ul>
                            <li>Pomodoro timer with customizable durations</li>
                            <li>Task management system</li>
                            <li>Session tracking and statistics</li>
                            <li>Dark and light themes</li>
                            <li>Data export/import</li>
                            <li>Browser notifications</li>
                            <li>Keyboard shortcuts</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quality Dialog Modal -->
    <div class="quality-dialog-modal" id="qualityDialogModal" onclick="closeQualityDialogOnBackgroundClick(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <span class="material-symbols-outlined" style="vertical-align: middle; margin-right: 8px;">star</span>
                    Rate Your Session Quality
                </h2>
            </div>
            
            <div class="quality-dialog-content">
                <p class="quality-dialog-message" id="qualityDialogMessage">How would you rate this session?</p>
                
                <div class="quality-slider-container">
                    <label class="quality-label" id="qualityLabel">Quality Rating</label>
                    <div class="quality-value-display" id="qualityValue">5</div>
                    <input type="range" class="quality-slider" id="qualitySlider" min="1" max="10" value="5" step="1">
                    <div class="quality-scale">
                        <span>1</span>
                        <span>2</span>
                        <span>3</span>
                        <span>4</span>
                        <span>5</span>
                        <span>6</span>
                        <span>7</span>
                        <span>8</span>
                        <span>9</span>
                        <span>10</span>
                    </div>
                </div>
                
                <div class="quality-buttons">
                    <button class="btn btn-secondary" onclick="skipQualityRating()">
                        <span class="material-symbols-outlined">skip_next</span>
                        <span>Skip</span>
                    </button>
                    <button class="btn btn-primary" onclick="submitQualityRating()">
                        <span class="material-symbols-outlined">check</span>
                        <span>Submit</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Fibonacci Guided Mode Modal -->
    <div class="settings-modal" id="fibonacciModal" onclick="closeModalOnBackgroundClick(event, 'fibonacciModal', closeFibonacciModal)">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <span class="material-symbols-outlined" style="vertical-align: middle; margin-right: 8px;">functions</span>
                    Fibonacci Mode Settings
                </h2>
                <button class="modal-info" onclick="showFibInfo()" title="Learn more">
                    <span class="material-symbols-outlined">info</span>
                </button>
                <button class="modal-close" onclick="closeFibonacciModal()">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <div class="fibonacci-modal-content">
                
                <div class="fibonacci-section">
                    <h3>Requirements</h3>
                    <div class="fibonacci-requirement">
                        <span class="material-symbols-outlined">info</span>
                        <p><strong>Quality Dialog must be enabled</strong> for Fibonacci Guided Mode to work. It will be automatically enabled when you activate this mode.</p>
                    </div>
                </div>
                
                <div class="fibonacci-section">
                    <h3>Settings</h3>
                    <div class="customization-grid">
                        <div class="custom-item">
                            <label>Decrease Threshold</label>
                            <input type="number" class="setting-input" id="fibDecreaseThreshold" value="7" min="1" max="10">
                        </div>
                        <div class="custom-item">
                            <label>Increase Threshold</label>
                            <input type="number" class="setting-input" id="fibIncreaseThreshold" value="10" min="1" max="10">
                        </div>
                        <div class="custom-item">
                            <label>Min Duration (min)</label>
                            <input type="number" class="setting-input" id="fibMinDuration" value="1" min="1" max="89">
                        </div>
                        <div class="custom-item">
                            <label>Max Duration (min)</label>
                            <input type="number" class="setting-input" id="fibMaxDuration" value="89" min="1" max="89">
                        </div>
                    </div>
                </div>
                
                <div class="fibonacci-actions">
                    <button class="btn btn-primary" onclick="saveFibonacciCustomization()">
                        <span class="material-symbols-outlined">save</span>
                        <span>Save</span>
                    </button>
                    <button class="btn btn-secondary" onclick="closeFibonacciModal()">
                        <span class="material-symbols-outlined">close</span>
                        <span>Close</span>
                    </button>
                    <button class="btn btn-primary" id="activateFibBtn" onclick="activateFibonacciMode()">
                        <span class="material-symbols-outlined">check</span>
                        <span>Activate Fibonacci Mode</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="services/encryptionService.js"></script>
    <script src="services/storageService.js"></script>
    <script src="services/blurControl.js"></script>
    <script src="app.js"></script>
</body>
</html>
